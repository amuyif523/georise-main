
> backend@1.0.0 test
> dotenv -e .env.test -- vitest run test/userRbac.test.ts


[1m[7m[36m RUN [39m[27m[22m [36mv2.1.9 [39m[90mC:/Users/Amanuel/Desktop/georise-main/backend[39m

[90mstdout[2m | test/userRbac.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env.test -- tip: ΓÜÖ∩╕Å  specify custom .env file path with { path: '/custom/path/.env' }

{"level":30,"time":1770649341219,"pid":26064,"hostname":"DESKTOP-3P240QT","msg":"Incident AI Queue initialized"}
node.exe : 
Sourcemap for "C:/Us
ers/Amanuel/Desktop/
georise-main/node_mo
dules/node-cron/dist
/esm/node-cron.js" 
points to missing 
source files
At C:\Program Files\
nodejs\npm.ps1:29 
char:3
+   & $NODE_EXE 
$NPM_CLI_JS $args
+   ~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~
    + CategoryInfo  
            : NotS  
  pecified: (Sour   
 cemap for "...n    
g source files:    
String) [], Rem    
oteException
    + FullyQualifie 
   dErrorId : Nati  
  veCommandError
 
 [31mΓ¥»[39m test/userRbac.test.ts [2m([22m[2m2 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[90m 27[2mms[22m[39m
[31m   [31m├ù[31m User RBAC and deactivation[2m > [22mblocks login and refresh for deactivated users[90m 6[2mms[22m[31m[39m
[31m     ΓåÆ default.$executeRawUnsafe is not a function[39m
[31m   [31m├ù[31m User RBAC and deactivation[2m > [22mprevents agency staff from mutating users in other agencies[90m 1[2mms[22m[31m[39m
[31m     ΓåÆ default.$executeRawUnsafe is not a function[39m

[31mΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»
ΓÄ»ΓÄ»[1m[7m 
Failed Tests 2 [27m
[22mΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»
ΓÄ»ΓÄ»[39m

[31m[1m[7m FAIL 
[27m[22m[39m test
/userRbac.test.ts[2
m > [22mUser RBAC 
and 
deactivation[2m > 
[22mblocks login 
and refresh for 
deactivated users
[31m[1m[7m FAIL 
[27m[22m[39m test
/userRbac.test.ts[2
m > [22mUser RBAC 
and 
deactivation[2m > 
[22mprevents 
agency staff from 
mutating users in 
other agencies
[31m[1mTypeError[
22m: default.$execut
eRawUnsafe is not a 
function[39m
[36m [2mΓ¥»[22m 
resetDatabase test/u
tils/db.ts:[2m28:16
[22m[39m
    [90m 26| [39m
[35mexport[39m 
[35mconst[39m 
resetDatabase 
[33m=[39m 
[35masync[39m () 
[33m=>[39m {
    [90m 27| [39m 
 [35mconst[39m 
quoted [33m=[39m 
[33mTABLES[39m[33m
.[39m[34mmap[39m(
(t) [33m=>[39m [3
2m`"[39m[36m${[39
mt[36m}[39m[32m"`
[39m)[33m.[39m[3
4mjoin[39m([32m', 
'[39m)[33m;[39m
    [90m 28| [39m 
 [35mawait[39m pri
sma[33m.[39m[34m$
executeRawUnsafe[39
m([32m`TRUNCATE 
TABLE [39m[36m${[
39mquoted[36m}[39m
[32m RESTART 
IDE[39mΓÇª
    [90m   | [39m 
              
[31m^[39m
    [90m 29| [39m 
 [35mawait[39m red
is[33m.[39m[34mfl
ushall[39m()[33m;
[39m
    [90m 30| 
[39m}[33m;[39m
[90m [2mΓ¥»[22m t
est/setup.ts:[2m56:
11[22m[39m

[31m[2mΓÄ»ΓÄ»ΓÄ»ΓÄ
»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»Γ
Ä»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»
ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ
»[1/2]ΓÄ»[22m[39m

[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[90m (2)[39m
[2m   Start at [22m 18:02:19
[2m   Duration [22m 3.16s[2m (transform 822ms, setup 115ms, collect 2.48s, tests 27ms, environment 0ms, prepare 204ms)[22m

